---
/**
 * Contact Page - Form with Turnstile and Resend
 */
import Base from '../layouts/Base.astro';
import TurnstileWidget from '../components/TurnstileWidget.astro';
import { actions } from 'astro:actions';
---

<Base title="Contact | My Website" description="Get in touch with us">
  <main class="container mx-auto max-w-xl px-4 py-16">
    <h1 class="mb-8 text-center text-3xl font-bold">Contact Us</h1>

    <form id="contact-form" method="POST" class="space-y-6">
      <div>
        <label for="name" class="mb-1 block text-sm font-medium">Name</label>
        <input
          type="text"
          id="name"
          name="name"
          required
          minlength="2"
          class="w-full rounded-lg border px-4 py-2 focus:border-blue-500 focus:ring-blue-500 dark:border-gray-700 dark:bg-gray-800"
          placeholder="Your name"
        />
      </div>

      <div>
        <label for="email" class="mb-1 block text-sm font-medium">Email</label>
        <input
          type="email"
          id="email"
          name="email"
          required
          class="w-full rounded-lg border px-4 py-2 focus:border-blue-500 focus:ring-blue-500 dark:border-gray-700 dark:bg-gray-800"
          placeholder="you@example.com"
        />
      </div>

      <div>
        <label for="message" class="mb-1 block text-sm font-medium">Message</label>
        <textarea
          id="message"
          name="message"
          required
          minlength="10"
          rows="4"
          class="w-full rounded-lg border px-4 py-2 focus:border-blue-500 focus:ring-blue-500 dark:border-gray-700 dark:bg-gray-800"
          placeholder="Your message..."
        ></textarea>
      </div>

      <TurnstileWidget class="flex justify-center" />

      <button
        type="submit"
        class="w-full rounded-lg bg-blue-600 px-4 py-3 font-medium text-white hover:bg-blue-700 disabled:opacity-50"
      >
        Send Message
      </button>

      <div id="form-status" class="hidden rounded-lg p-4 text-center"></div>
    </form>
  </main>
</Base>

<script>
  import { actions } from 'astro:actions';

  const form = document.getElementById('contact-form') as HTMLFormElement;
  const status = document.getElementById('form-status') as HTMLDivElement;

  form?.addEventListener('submit', async (e) => {
    e.preventDefault();
    const formData = new FormData(form);
    const button = form.querySelector('button[type="submit"]') as HTMLButtonElement;

    button.disabled = true;
    button.textContent = 'Sending...';
    status.classList.add('hidden');

    const { error } = await actions.contact(formData);

    if (error) {
      status.textContent = error.message || 'Something went wrong. Please try again.';
      status.className = 'rounded-lg p-4 text-center bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200';
    } else {
      status.textContent = 'Message sent successfully!';
      status.className = 'rounded-lg p-4 text-center bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200';
      form.reset();
      // Reset Turnstile widget
      if (window.turnstile) {
        window.turnstile.reset();
      }
    }

    button.disabled = false;
    button.textContent = 'Send Message';
  });
</script>
