---
/**
 * Plausible Analytics Component (Oct 2025 Script Format)
 *
 * Uses unique script ID per site with the new pa-xxx format.
 * For self-hosted instances, endpoint is specified explicitly.
 *
 * @see https://plausible.io/docs/script-update-guide
 *
 * Usage:
 * 1. Get scriptId from Plausible dashboard (Settings > Site Installation)
 * 2. Pass scriptId and optionally host as props
 *
 * Examples:
 * - Plausible Cloud: <PlausibleAnalytics scriptId="pa-xxx" host="https://plausible.io" />
 * - Self-hosted: <PlausibleAnalytics scriptId="pa-xxx" host="https://analytics.yourdomain.com" />
 *
 * Note: Script IDs and host URLs should be stored in credentials.env
 * and referenced via environment variables in production.
 */

interface Props {
  scriptId: string;
  host?: string;
}

const {
  scriptId,
  host = 'https://plausible.io', // Default to Plausible Cloud
} = Astro.props;

// Skip rendering if no scriptId provided
if (!scriptId) {
  return;
}

const scriptUrl = `${host}/js/${scriptId}.js`;
const apiEndpoint = `${host}/api/event`;
---

<script is:inline async src={scriptUrl}></script>
<script is:inline define:vars={{ apiEndpoint }}>
  window.plausible=window.plausible||function(){(plausible.q=plausible.q||[]).push(arguments)},plausible.init=plausible.init||function(i){plausible.o=i||{}};
  plausible.init({ endpoint: apiEndpoint });
</script>
